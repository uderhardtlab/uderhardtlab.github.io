<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uderhardt Lab | Computational Biology & Microscopy</title>
    <meta name="description" content="We develop computational tools to decode the spatial organization of cells and tissues, revealing the hidden geometry of biological systems.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700;800&family=Montserrat:wght@300;400;500;600;700;800&family=Oswald:wght@300;400;500;600;700&family=Raleway:wght@300;400;500;600;700;800&family=Crimson+Text:wght@400;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           CSS DESIGN SYSTEM
           ============================================ */
        :root {
            /* Background */
            --void: #030108;
            --deep: #0a0510;

            /* Text */
            --text: #f5f3ff;
            --text-dim: rgba(245, 243, 255, 0.7);
            --text-muted: rgba(245, 243, 255, 0.4);

            /* Accent */
            --filament: #a855f7;
            --node: #f0abfc;
            --plasma: #e879f9;

            /* Team Colors (Wes Anderson Palette) */
            --pi-cell: #d4a5a5;
            --pi-nucleus: #e8c4c4;
            --postdoc-cell: #d4b896;
            --postdoc-nucleus: #e8d4b8;
            --tech-cell: #a5c4b8;
            --tech-nucleus: #c4ddd4;
            --phd-cell: #a5b8d4;
            --phd-nucleus: #c4d4e8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--void);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            line-height: 1.2;
        }

        a {
            color: var(--node);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--plasma);
        }

        /* ============================================
           NAVIGATION
           ============================================ */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .nav.scrolled {
            background: rgba(3, 1, 8, 0.9);
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 30px rgba(168, 85, 247, 0.1);
            padding: 1rem 2rem;
        }

        .nav-logo {
            font-family: 'Syne', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--text);
        }

        .nav-links {
            display: none;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-dim);
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--node);
        }

        .nav-toggle {
            display: flex;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            z-index: 1001;
        }

        .nav-toggle span {
            width: 24px;
            height: 2px;
            background: var(--text);
            transition: all 0.3s ease;
        }

        .nav-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .nav-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .nav-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--void);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu a {
            font-family: 'Syne', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        @media (min-width: 768px) {
            .nav-links {
                display: flex;
            }

            .nav-toggle {
                display: none;
            }
        }

        /* ============================================
           HERO SECTION
           ============================================ */
        .hero {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            overflow: hidden;
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            z-index: 1;
            background-image: url('images/hero.png');
            background-size: cover;
            background-position: center;
            filter: saturate(1.1) brightness(0.85);
            transition: transform 0.1s ease-out;
        }

        #electricCanvas {
            position: absolute;
            inset: 0;
            z-index: 2;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        .hero-glow {
            position: absolute;
            inset: 0;
            z-index: 3;
            pointer-events: none;
            background:
                radial-gradient(ellipse at 30% 40%, rgba(168, 85, 247, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(240, 171, 252, 0.1) 0%, transparent 40%);
            animation: glowPulse 4s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .hero-fade {
            position: absolute;
            inset: 0;
            z-index: 4;
            pointer-events: none;
            background:
                linear-gradient(to bottom, #030108 0%, transparent 25%),
                linear-gradient(to top, #030108 0%, transparent 30%),
                radial-gradient(ellipse at center, transparent 30%, #030108 90%);
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .hero-label {
            display: inline-block;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: var(--node);
            margin-bottom: 1.5rem;
            padding: 0.5rem 1.2rem;
            background: rgba(3, 1, 8, 0.65);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border: 1px solid rgba(240, 171, 252, 0.3);
            border-radius: 50px;
        }

        .hero-title {
            display: inline;
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--text) 0%, var(--node) 50%, var(--plasma) 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 5s ease infinite;
            padding: 0.2rem 0.8rem;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        .hero-title-wrapper {
            margin-bottom: 1.5rem;
            background: rgba(3, 1, 8, 0.65);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            display: inline-block;
            padding: 0.5rem 0.8rem;
            border-radius: 12px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .hero-subtitle {
            font-size: clamp(1rem, 2.5vw, 1.25rem);
            color: var(--text-dim);
            max-width: 500px;
            line-height: 1.8;
            background: rgba(3, 1, 8, 0.65);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            text-align: center;
        }

        .scroll-hint {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            animation: bounce 2s infinite;
        }

        .scroll-hint svg {
            width: 30px;
            height: 30px;
            stroke: var(--text-muted);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }

        /* ============================================
           PARTICLES CANVAS
           ============================================ */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* ============================================
           SECTIONS COMMON
           ============================================ */
        .section {
            position: relative;
            padding: 6rem 2rem;
            z-index: 10;
        }

        .section-deep {
            background: var(--deep);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 1rem;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-dim);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Scroll Reveal */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
        }

        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .delay-1 { transition-delay: 0.1s; }
        .delay-2 { transition-delay: 0.2s; }
        .delay-3 { transition-delay: 0.3s; }
        .delay-4 { transition-delay: 0.4s; }

        /* ============================================
           RESEARCH SECTION
           ============================================ */
        .research-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 3rem;
            align-items: center;
        }

        @media (min-width: 768px) {
            .research-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .research-image {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
        }

        .research-image img,
        .research-image video {
            width: 100%;
            height: auto;
            display: block;
        }

        .research-image::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--filament), var(--plasma), var(--node));
            border-radius: 22px;
            z-index: -1;
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0.5; filter: blur(5px); }
            50% { opacity: 1; filter: blur(10px); }
        }

        .research-intro {
            font-size: 1.1rem;
            color: var(--text-dim);
            line-height: 1.8;
            margin-bottom: 2rem;
        }

        .research-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 3rem;
        }

        .research-card {
            background: rgba(168, 85, 247, 0.05);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .research-card:hover {
            background: rgba(168, 85, 247, 0.1);
            border-color: rgba(168, 85, 247, 0.4);
            transform: translateY(-5px);
        }

        .research-card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .research-card h3 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--node);
        }

        .research-card p {
            font-size: 0.95rem;
            color: var(--text-dim);
            line-height: 1.7;
        }

        /* ============================================
           TEAM SECTION
           ============================================ */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            justify-items: center;
        }

        .team-member {
            text-align: center;
            padding: 1.5rem;
        }

        .cell-avatar {
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem;
        }

        .cell-blob {
            animation: cellPulse 4s ease-in-out infinite;
            transform-origin: center;
        }

        .cell-nucleus {
            animation: nucleusPulse 3s ease-in-out infinite;
            transform-origin: center;
        }

        .cell-organelle {
            animation: organelleFloat 5s ease-in-out infinite;
        }

        @keyframes cellPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        @keyframes nucleusPulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        @keyframes organelleFloat {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(5px, -4px); }
            50% { transform: translate(-3px, 5px); }
            75% { transform: translate(-5px, -3px); }
        }

        .team-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .team-role {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .team-links {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .team-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.2);
            color: var(--text-dim);
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .team-link:hover {
            background: rgba(168, 85, 247, 0.3);
            border-color: var(--filament);
            color: var(--text);
            transform: translateY(-2px);
        }

        .team-link svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* ============================================
           FUNDING SECTION
           ============================================ */
        .funding-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
        }

        .funding-card {
            background: rgba(168, 85, 247, 0.05);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .funding-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(168, 85, 247, 0.15);
        }

        .funding-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .funding-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .funding-program {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* ============================================
           PUBLICATIONS SECTION
           ============================================ */
        .pub-stats {
            display: flex;
            justify-content: center;
            gap: 4rem;
            margin-bottom: 4rem;
            flex-wrap: wrap;
        }

        .pub-stat {
            text-align: center;
        }

        .pub-stat-number {
            font-family: 'Syne', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--node), var(--plasma));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pub-stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .pub-stat-link {
            width: 100%;
            text-align: center;
            margin-top: 1rem;
        }

        .scholar-link {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--filament);
            border-radius: 50px;
            font-size: 0.9rem;
            color: var(--node);
            transition: all 0.3s ease;
        }

        .scholar-link:hover {
            background: var(--filament);
            color: var(--void);
        }

        .featured-pub {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(240, 171, 252, 0.05));
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 4rem;
            position: relative;
        }

        .featured-badge {
            position: absolute;
            top: -12px;
            left: 2rem;
            background: linear-gradient(135deg, var(--filament), var(--plasma));
            color: var(--void);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.5rem 1rem;
            border-radius: 50px;
        }

        .featured-pub h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .featured-pub .authors {
            color: var(--text-dim);
            margin-bottom: 0.5rem;
        }

        .featured-pub .authors .highlight {
            color: var(--node);
        }

        .featured-pub .journal {
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 1.5rem;
        }

        .pub-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .pub-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            border: 1px solid var(--filament);
            border-radius: 50px;
            font-size: 0.85rem;
            color: var(--node);
            transition: all 0.3s ease;
        }

        .pub-link:hover {
            background: var(--filament);
            color: var(--void);
        }

        .pub-timeline {
            position: relative;
            padding-left: 2rem;
        }

        .pub-timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--filament), var(--plasma), transparent);
            box-shadow: 0 0 10px var(--filament);
        }

        .pub-year {
            position: relative;
            margin-bottom: 2rem;
        }

        .pub-year-marker {
            position: absolute;
            left: -2rem;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: var(--node);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--node);
        }

        .pub-year-label {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--node);
            margin-bottom: 1rem;
            padding-left: 1rem;
        }

        .pub-item {
            background: rgba(168, 85, 247, 0.03);
            border-left: 3px solid rgba(168, 85, 247, 0.3);
            padding: 1.5rem;
            margin-bottom: 1rem;
            margin-left: 1rem;
            transition: all 0.3s ease;
        }

        .pub-item:hover {
            background: rgba(168, 85, 247, 0.08);
            border-left-color: var(--filament);
        }

        .pub-item h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .pub-item .authors {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-bottom: 0.25rem;
        }

        .pub-item .authors .highlight {
            color: var(--node);
        }

        .pub-item .journal {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .pub-item h4 a {
            color: var(--text);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .pub-item h4 a:hover {
            color: var(--node);
        }

        .pub-item-links {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .pub-item-link {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.3rem 0.6rem;
            border: 1px solid rgba(168, 85, 247, 0.4);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--text-dim);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .pub-item-link:hover {
            background: rgba(168, 85, 247, 0.2);
            border-color: var(--filament);
            color: var(--node);
        }

        .pub-item-link svg {
            width: 12px;
            height: 12px;
        }

        .pub-details-btn {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--filament);
            cursor: pointer;
        }

        .pub-details-btn:hover {
            background: var(--filament);
            color: var(--void);
        }

        /* Publication Modal */
        .pub-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(3, 1, 8, 0.95);
            backdrop-filter: blur(10px);
            overflow-y: auto;
            padding: 2rem;
        }

        .pub-modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .pub-modal-content {
            position: relative;
            max-width: 900px;
            width: 100%;
            background: var(--deep);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
        }

        .pub-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(168, 85, 247, 0.2);
            color: var(--text);
            font-size: 1.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pub-modal-close:hover {
            background: var(--filament);
            color: var(--void);
        }

        .pub-modal-header {
            margin-bottom: 1.5rem;
            padding-right: 3rem;
        }

        .pub-modal-header h3 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text);
        }

        .pub-modal-header .authors {
            color: var(--text-dim);
            margin-bottom: 0.25rem;
        }

        .pub-modal-header .journal {
            color: var(--text-muted);
            font-style: italic;
        }

        .pub-graphical-abstract {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .pub-graphical-abstract.visible {
            display: block;
        }

        .pub-description {
            color: var(--text-dim);
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }

        .pub-media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .pub-media-gallery img,
        .pub-media-gallery video {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .pub-modal-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            padding-top: 1rem;
            border-top: 1px solid rgba(168, 85, 247, 0.2);
        }

        .funding-card.has-link {
            cursor: pointer;
        }

        /* ============================================
           NEWS SECTION
           ============================================ */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .news-card {
            background: var(--deep);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .news-card:hover {
            transform: translateY(-5px);
            border-color: var(--filament);
            box-shadow: 0 10px 40px rgba(168, 85, 247, 0.15);
        }

        .news-date {
            font-size: 0.8rem;
            color: var(--filament);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .news-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text);
        }

        .news-excerpt {
            font-size: 0.95rem;
            color: var(--text-dim);
            line-height: 1.6;
        }

        .news-link {
            display: inline-block;
            margin-top: 1rem;
            color: var(--node);
            font-size: 0.9rem;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .news-link:hover {
            color: var(--filament);
        }

        .news-tag {
            display: inline-block;
            background: rgba(168, 85, 247, 0.2);
            color: var(--node);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-bottom: 0.75rem;
        }

        /* ============================================
           GALLERY SECTION
           ============================================ */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 4/3;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gallery-item:hover {
            transform: scale(1.02);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem;
            background: linear-gradient(transparent, rgba(3, 1, 8, 0.9));
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        .gallery-caption {
            font-size: 0.95rem;
            color: var(--text);
            font-weight: 500;
        }

        .gallery-description {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }

        /* Gallery Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(3, 1, 8, 0.98);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 2rem;
        }

        .lightbox.active {
            opacity: 1;
            visibility: visible;
        }

        .lightbox-content {
            max-width: 90vw;
            max-height: 85vh;
            position: relative;
        }

        .lightbox-content img {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .lightbox-caption {
            text-align: center;
            margin-top: 1rem;
            color: var(--text);
        }

        .lightbox-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 50px;
            height: 50px;
            border: none;
            background: rgba(168, 85, 247, 0.3);
            border-radius: 50%;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 3001;
        }

        .lightbox-close:hover {
            background: var(--filament);
            color: var(--void);
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border: none;
            background: rgba(168, 85, 247, 0.3);
            border-radius: 50%;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lightbox-nav:hover {
            background: var(--filament);
            color: var(--void);
        }

        .lightbox-prev {
            left: 1rem;
        }

        .lightbox-next {
            right: 1rem;
        }

        @media (max-width: 768px) {
            .lightbox-nav {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }

        /* ============================================
           RESEARCH MODAL
           ============================================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(3, 1, 8, 0.95);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            max-width: 800px;
            margin: 2rem auto;
            background: var(--deep);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 20px;
            padding: 2.5rem;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(168, 85, 247, 0.2);
            border-radius: 50%;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--filament);
            color: var(--void);
        }

        .modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--node);
        }

        .modal-body {
            color: var(--text-dim);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .modal-body p {
            margin-bottom: 1rem;
        }

        .modal-body ul, .modal-body ol {
            margin: 1rem 0 1rem 1.5rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
        }

        .modal-body img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 1.5rem 0;
            display: block;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-body img.float-left {
            float: left;
            max-width: 45%;
            margin: 0.5rem 1.5rem 1rem 0;
        }

        .modal-body img.float-right {
            float: right;
            max-width: 45%;
            margin: 0.5rem 0 1rem 1.5rem;
        }

        .modal-body img.small {
            max-width: 300px;
        }

        .modal-body img.medium {
            max-width: 500px;
        }

        .modal-body .image-caption {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: -1rem;
            margin-bottom: 1.5rem;
        }

        .modal-body .clearfix::after {
            content: "";
            display: table;
            clear: both;
        }

        @media (max-width: 768px) {
            .modal-body img.float-left,
            .modal-body img.float-right {
                float: none;
                max-width: 100%;
                margin: 1rem 0;
            }
        }

        @media (max-width: 768px) {
            .modal-overlay {
                padding: 1rem;
            }

            .modal-content {
                margin: 1rem auto;
                padding: 1.5rem;
            }

            .modal-title {
                font-size: 1.5rem;
            }
        }

        /* Clickable research cards */
        .research-card.clickable {
            cursor: pointer;
        }

        .research-card.clickable::after {
            content: '→';
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            opacity: 0;
            transition: all 0.3s ease;
            color: var(--node);
        }

        .research-card.clickable:hover::after {
            opacity: 1;
        }

        .research-card {
            position: relative;
        }

        /* ============================================
           FOOTER
           ============================================ */
        .footer {
            background: var(--void);
            border-top: 1px solid rgba(168, 85, 247, 0.2);
            padding: 4rem 2rem 2rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-legal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .footer-legal-item h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-dim);
        }

        .footer-legal-item p {
            font-size: 0.8rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(168, 85, 247, 0.1);
        }

        .footer-bottom p {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        /* ============================================
           TAP RIPPLE (MOBILE)
           ============================================ */
        .ripple {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.4), transparent);
            transform: scale(0);
            animation: rippleEffect 0.8s ease-out forwards;
            pointer-events: none;
            z-index: 9999;
        }

        @keyframes rippleEffect {
            to {
                transform: scale(1);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Hidden SVG Definitions -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;">
        <defs>
            <!-- PI Gradients -->
            <linearGradient id="piCellGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#d4a5a5"/>
                <stop offset="100%" style="stop-color:#c08080"/>
            </linearGradient>
            <linearGradient id="piNucleusGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#e8c4c4"/>
                <stop offset="100%" style="stop-color:#d4a5a5"/>
            </linearGradient>

            <!-- PostDoc Gradients -->
            <linearGradient id="postdocCellGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#d4b896"/>
                <stop offset="100%" style="stop-color:#c0a070"/>
            </linearGradient>
            <linearGradient id="postdocNucleusGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#e8d4b8"/>
                <stop offset="100%" style="stop-color:#d4b896"/>
            </linearGradient>

            <!-- Technician Gradients -->
            <linearGradient id="techCellGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#a5c4b8"/>
                <stop offset="100%" style="stop-color:#80a090"/>
            </linearGradient>
            <linearGradient id="techNucleusGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#c4ddd4"/>
                <stop offset="100%" style="stop-color:#a5c4b8"/>
            </linearGradient>

            <!-- PhD Gradients -->
            <linearGradient id="phdCellGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#a5b8d4"/>
                <stop offset="100%" style="stop-color:#8090c0"/>
            </linearGradient>
            <linearGradient id="phdNucleusGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#c4d4e8"/>
                <stop offset="100%" style="stop-color:#a5b8d4"/>
            </linearGradient>

            <!-- Glow Filters -->
            <filter id="glowPi" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glowPostdoc" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glowTech" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glowPhd" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
        </defs>
    </svg>

    <!-- Particles Canvas -->
    <canvas id="particles"></canvas>

    <!-- Navigation -->
    <nav class="nav" id="nav">
        <a href="#" class="nav-logo">Uderhardt Lab</a>
        <ul class="nav-links">
            <li><a href="#news">News</a></li>
            <li><a href="#research">Research</a></li>
            <li><a href="#team">Team</a></li>
            <li><a href="#funding">Funding</a></li>
            <li><a href="#publications">Publications</a></li>
            <li><a href="#gallery">Gallery</a></li>
        </ul>
        <div class="nav-toggle" id="navToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="#news">News</a>
        <a href="#research">Research</a>
        <a href="#team">Team</a>
        <a href="#funding">Funding</a>
        <a href="#publications">Publications</a>
        <a href="#gallery">Gallery</a>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-bg" id="heroBg"></div>
        <canvas id="electricCanvas"></canvas>
        <div class="hero-glow"></div>
        <div class="hero-fade"></div>
        <div class="hero-content">
            <span class="hero-label" id="heroLabel"></span>
            <div class="hero-title-wrapper">
                <h1 class="hero-title" id="heroTitle"></h1>
            </div>
            <p class="hero-subtitle" id="heroSubtitle"></p>
        </div>
        <div class="scroll-hint">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
            </svg>
        </div>
    </section>

    <!-- News Section -->
    <section class="section section-deep" id="news">
        <div class="container">
            <div class="section-header reveal">
                <h2 class="section-title">News</h2>
                <p class="section-subtitle">Latest updates from the lab</p>
            </div>
            <div class="news-grid reveal" id="newsGrid"></div>
        </div>
    </section>

    <!-- Research Section -->
    <section class="section" id="research">
        <div class="container">
            <div class="research-grid">
                <div class="research-image reveal">
                    <video src="images/research.m4v" autoplay loop muted playsinline></video>
                </div>
                <div class="research-content reveal delay-1">
                    <h2 class="section-title" id="researchTitle"></h2>
                    <p class="research-intro" id="researchIntro"></p>
                </div>
            </div>
            <div class="research-cards" id="researchCards"></div>
        </div>
    </section>

    <!-- Team Section -->
    <section class="section section-deep" id="team">
        <div class="container">
            <div class="section-header reveal">
                <h2 class="section-title">Team</h2>
                <p class="section-subtitle">current lab members</p>
            </div>
            <div class="team-grid" id="teamGrid"></div>
        </div>
    </section>

    <!-- Funding Section -->
    <section class="section section-deep" id="funding">
        <div class="container">
            <div class="section-header reveal">
                <h2 class="section-title">Funding & Support</h2>
                <p class="section-subtitle">Our research is generously supported by</p>
            </div>
            <div class="funding-grid" id="fundingGrid"></div>
        </div>
    </section>

    <!-- Publications Section -->
    <section class="section" id="publications">
        <div class="container">
            <div class="section-header reveal">
                <h2 class="section-title">Publications</h2>
                <p class="section-subtitle">Our contributions to the field</p>
            </div>
            <div class="pub-timeline reveal" id="pubTimeline"></div>
        </div>
    </section>

    <!-- Publication Detail Modal -->
    <div class="pub-modal" id="pubModal">
        <div class="pub-modal-content">
            <button class="pub-modal-close" onclick="closePublicationModal()">&times;</button>
            <div class="pub-modal-header">
                <h3 id="pubModalTitle"></h3>
                <p class="journal" id="pubModalJournal"></p>
            </div>
            <div class="pub-modal-body">
                <img id="pubModalAbstract" class="pub-graphical-abstract" src="" alt="Graphical Abstract">
                <div id="pubModalDescription" class="pub-description"></div>
                <div id="pubModalMedia" class="pub-media-gallery"></div>
            </div>
            <div class="pub-modal-links" id="pubModalLinks"></div>
        </div>
    </div>

    <!-- Stats Section -->
    <section class="section section-deep" id="stats">
        <div class="container">
            <div class="pub-stats reveal" id="pubStats"></div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section class="section" id="gallery">
        <div class="container">
            <div class="section-header reveal">
                <h2 class="section-title">Gallery</h2>
                <p class="section-subtitle">Images from our research</p>
            </div>
            <div class="gallery-grid reveal" id="galleryGrid"></div>
        </div>
    </section>

    <!-- Gallery Lightbox -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">‹</button>
        <div class="lightbox-content">
            <img id="lightboxImage" src="" alt="">
            <div class="lightbox-caption" id="lightboxCaption"></div>
        </div>
        <button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">›</button>
    </div>

    <!-- Research Modal -->
    <div class="modal-overlay" id="researchModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-icon" id="modalIcon"></div>
            <h2 class="modal-title" id="modalTitle"></h2>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-legal" id="footerLegal"></div>
            <div class="footer-bottom">
                <p id="footerCopyright"></p>
                <p id="footerAffiliation"></p>
            </div>
        </div>
    </footer>

    <script>
    /* ============================================
       EASY-TO-EDIT CONFIGURATION
       ============================================

       Edit the values below to update the website content.
       After editing, save the file - changes appear immediately.

    ============================================ */

    const CONFIG = {

        // ========================================
        // HERO SECTION
        // ========================================
        hero: {
            label: "Integrative Tissue Immunology",
            title: "UDERHARDT LAB",
            subtitle: "Med III | University Hospital Erlangen | Germany",
            // Styling
            labelSize: 1.1,         // rem (0.5-1.5)
            labelColor: "#a855f7",  // hex color
            titleSize: 4.0,           // rem (2-8)
            titleColor1: "#f0abfc", // gradient start
            titleColor2: "#a855f7", // gradient middle
            titleColor3: "#e879f9", // gradient end
            subtitleSize: 0.8,     // rem (0.8-2)
            subtitleColor: "rgba(245, 243, 255, 0.7)",
            // Fonts
            labelFont: "Space Grotesk",
            titleFont: "Space Grotesk",
            subtitleFont: "Space Grotesk"
        },

        // ========================================
        // IMAGES
        // To change images, replace the files in the images/ folder
        // ========================================
        images: {
            hero: "images/hero.png",
            research: "images/research.m4v"
        },

        // ========================================
        // ELECTRIC PULSE ANIMATION
        // ========================================
        pulses: {
            count: 2,
            speed: 5.0,
            size: 3.0000000000000004,
            length: 10000,
            sparkle: 5,
            hue: 94,
            saturation: 0,
            lifetime: 600,
            sparkleFade: 0.001
        },

        // ========================================
        // NEWS SECTION
        // ========================================
        news: [
            {
                date: "December 2024",
                tag: "Award",
                title: "ERC Starting Grant awarded",
                excerpt: "We received funding from the European Research Council for our research program.",
                url: ""
            },
            {
                date: "November 2024",
                tag: "Team",
                title: "Welcome new lab members",
                excerpt: "We are excited to welcome two new PhD students to our team.",
                url: ""
            }
        ],

        // ========================================
        // RESEARCH SECTION
        // ========================================
        research: {
            title: "Understanding Cellular Organization Through Advanced Imaging",
            intro: "Our lab sits at the intersection of computational biology and microscopy. We develop novel algorithms and tools to extract meaningful insights from complex 3D imaging data, enabling researchers to study cellular morphology at unprecedented scales.",

            // Add/remove/edit research areas here
            areas: [
                {
                    icon: "",
                    title: "3D Cell Segmentation",
                    text: "We develop deep learning approaches to accurately segment complex cellular structures in volumetric microscopy data, handling challenging cases like densely packed tissues and irregular morphologies.",
                    detail: "We develop deep learning approaches to accurately segment complex cellular structures in volumetric microscopy data, handling challenging cases like densely packed tissues and irregular morphologies.<br>We develop deep learning approaches to accurately segment complex cellular structures in volumetric microscopy data, handling challenging cases like densely packed tissues and irregular morphologies.<br>We develop deep learning approaches to accurately segment complex cellular structures in volumetric microscopy data, handling challenging cases like densely packed tissues and irregular morphologies."
                },
                {
                    icon: "",
                    title: "Morphological Analysis",
                    text: "Our MORPHISTO platform quantifies cell shape, size, and spatial relationships, enabling researchers to understand how cellular form relates to function across development and disease.",
                    detail: ""
                },
                {
                    icon: "",
                    title: "Open-Source Tools",
                    text: "We believe in making advanced image analysis accessible. All our tools are open-source and designed to integrate seamlessly with existing workflows in napari, Fiji, and Python.",
                    detail: ""
                }
            ]
        },

        // ========================================
        // TEAM MEMBERS
        // Types: "pi", "postdoc", "technician", "phd"
        // Each type has a unique cell avatar style
        // ========================================
        team: [
            { name: "Stefan Uderhardt", role: "Principal Investigator", type: "pi", googleScholar: "", linkedin: "", researchGate: "", github: "", orcid: "", website: "", websiteLabel: "" },
            { name: "Christian Maueröder", role: "PostDoc", type: "postdoc", googleScholar: "https://scholar.google.com/citations?user=TQZMIK8AAAAJ&hl=de", linkedin: "https://de.linkedin.com/in/christian-maueroeder", researchGate: "", github: "", orcid: "", website: "", websiteLabel: "" },
            { name: "Eric Greto", role: "PhD Student", type: "phd", googleScholar: "", linkedin: "https://de.linkedin.com/in/eric-greto-563b08186", researchGate: "", github: "https://github.com/EricGreto", orcid: "", website: "", websiteLabel: "" },
            { name: "Anna Möller", role: "PhD Student", type: "phd", googleScholar: "https://scholar.google.com/citations?user=JP-4HScAAAAJ&hl=de", linkedin: "", researchGate: "", github: "https://github.com/annmoel", orcid: "", website: "", websiteLabel: "" },
            { name: "Lijian 'Lizzie' Li", role: "PhD Student", type: "phd", googleScholar: "", linkedin: "", researchGate: "", github: "", orcid: "", website: "https://www.immunomicrotope.de/person/lijian-li/", websiteLabel: "RTG2740" },
            { name: "Daniela Weidner", role: "Technician", type: "technician", googleScholar: "", linkedin: "", researchGate: "", github: "", orcid: "https://orcid.org/0009-0008-6637-5071", website: "", websiteLabel: "" },
            { name: "Margarete Schimpf", role: "Technician", type: "technician", googleScholar: "", linkedin: "", researchGate: "", github: "", orcid: "", website: "", websiteLabel: "" },
            { name: "Oumaima Ben Brahim", role: "PhD Student", type: "phd", googleScholar: "", linkedin: "https://de.linkedin.com/in/oumaima-ben-brahim-247085160", researchGate: "https://www.researchgate.net/profile/Oumaima-Ben-Brahim", github: "", orcid: "", website: "", websiteLabel: "" },
            { name: "Kara Nachtnebel", role: "PhD Student", type: "phd", googleScholar: "", linkedin: "", researchGate: "", github: "https://github.com/KaraNa182", orcid: "", website: "https://www.trr369-dione.de/team/nachtnebel-alexander/", websiteLabel: "TRR369" },
            { name: "Jonas Utz", role: "PhD Student", type: "phd", googleScholar: "https://scholar.google.com/citations?user=KC3Y4v8AAAAJ&hl=de", linkedin: "https://de.linkedin.com/in/jonas-utz-8486bb33b", researchGate: "", github: "https://github.com/jonasutz", orcid: "", website: "https://www.aimi.tf.fau.de/person/jonas-utz/", websiteLabel: "AIMI" }
        ],

        // ========================================
        // FUNDING SOURCES
        // Add new funders by adding objects to this array
        // ========================================
        funders: [
            { name: "ERC", program: "Starting Grant", icon: "EU", url: "" },
            { name: "University", program: "Core Funding", icon: "UNI", url: "" }
        ],

        // ========================================
        // PUBLICATION STATISTICS
        // ========================================
        stats: {
            publications: 50,
            citations: "5.9k",
            hIndex: 22,
            scholarUrl: "https://scholar.google.com/citations?user=Yp5bvrsAAAAJ"
        },

        // ========================================
        // PUBLICATIONS BY YEAR
        // Each publication can have: publisherUrl, depositUrl, codeUrl
        // Plus popup details: graphicalAbstract, description, media
        // ========================================
        publications: {
            2025: [
                {
                    title: "Matrix-producing neutrophils populate and shield the skin.",
                    authors: "Vicanolo T, Özcan A, Li JL, Huerta-López C, Ballesteros I, Rubio-Ponce A, Dumitru AC, Nicolás-Ávila JÁ, Molina-Moreno M, Reyes-Gutierrez P, Johnston AD, Martone C, Greto E, Quílez-Alvarez A, Calvo E, Bonzon-Kulichenko E, Álvarez-Velez R, Chooi MY, Kwok I, González-Bermúdez B, Malleret B, Espinosa FM, Zhang M, Wang YL, Sun D, Zhen Chong S, El-Armouche A, Kim KK, Udalova IA, Greco V, Garcia R, Vázquez J, Dopazo A, Plaza GR, Alegre-Cebollada J, Uderhardt S, Ng LG, Hidalgo A",
                    journal: "Nature, 2025",
                    publisherUrl: "https://doi.org/10.1038/s41586-025-08741-5",
                    depositUrl: "https://paperpile.com/shared/smOcy5Ek3RyygqrS887rq7Q",
                    codeUrl: "",
                    graphicalAbstract: "images/vicanolo.png",
                    description: `<p>In this collaborative study, together with the labs of Andres Hidalgo and Laiguan Ng, we uncovered an unexpected structural role for neutrophils in the skin: they do not just arrive to kill microbes, they literally help build and reinforce the barrier itself...</p>
<br>
<h4>What we found...</h4>
<br>
<p>We surveyed immune diversity across multiple tissues and picked up a distinct neutrophil population in the skin that is unusually rich in extracellular matrix (ECM)-related proteins and enzymes. In steady-state skin, these matrix-producing neutrophils are already embedded in the tissue where they contribute to ECM composition, stiffen the matrix, and, as a result, strengthen barrier function before any overt inflammation. When we injured the skin, these neutrophils switched into an architectural program: they assembled ECM “rings” encircling the wound, physically walling off the damaged area from foreign molecules and bacteria.</p>
<br>
<h4>Mechanism: TGFbeta-dependent “shielding” program</h4>
<br>
<p>We traced this structural behavior to TGFbeta signaling in neutrophils: when we disabled the TGFbeta receptor specifically in these cells, the matrix rings failed to form properly around wounds. Loss of this neutrophil TGFbeta pathway did not just change morphology; it made the wounds more permissive to bacterial invasion, directly linking the structural program to antimicrobial protection. Conceptually, this places neutrophils as dual-function cells in the skin: rapid toxic killers, but also on-site matrix engineers that create a physical, ECM-based shield against the outside world.</p>
<br>
<h4>Why this matters clinically…</h4>
<br>
<p>Clinically, this suggests that defects in neutrophil-ECM programs or TGFbeta responsiveness could contribute to fragile skin barriers, recurrent infections, or impaired wound healing, even when neutrophil counts appear “normal.” It points to a therapeutic angle where, instead of only boosting antimicrobial killing, we might try to enhance or restore this structural shielding program-for example, by modulating TGFbeta pathways in neutrophils or by mimicking their matrix output in chronic wounds. More broadly, it reframes how we think about innate immunity in barrier organs: some leukocytes may be best understood and eventually targeted as tissue builders that physically armor the host, not merely as transient inflammatory visitors.</p>`,
                    media: []
                },
                {
                    title: "Cellular morphodynamics as quantifiers for functional states of resident tissue macrophages in vivo.",
                    authors: "Schnitzerlein M, Greto E, Wegner A, Möller A, Aust O, Ben Brahim O, Blumenthal DB, Zaburdaev V, Uderhardt S",
                    journal: "PLoS computational biology, 2025",
                    publisherUrl: "https://doi.org/10.1371/journal.pcbi.1011859",
                    depositUrl: "https://paperpile.com/shared/sXM_Hynb3SE~v28guQcuspA",
                    codeUrl: "",
                    graphicalAbstract: "images/schnitzerlein.png",
                    description: `<p>In this PLoS Computational Biology study, we set out to turn the “gut feeling” many of us have when watching macrophages under the microscope (that their shape and behavior encode functional state) into quantitative, human‑interpretable metrics that we can actually measure and compare across conditions.</p>
<br>
<h4>What we found...</h4>
<br>
<p>We used intravital microscopy of peritoneal resident tissue macrophages (RTMs) in mice and built an image analysis pipeline that tracks cells over time and extracts a panel of size and shape features, effectively capturing their morphodynamics as trajectories in a multidimensional “morphospace.” Within this morphospace, steady-state RTMs did not cluster into a single behavior but instead occupied a surprisingly broad range of morphological and dynamic phenotypes, which we interpret as a naïve behavioral landscape of the tissue-resident compartment. When we perturbed the system—by inducing pro- or anti-inflammatory activation or by creating endosomal dysfunction—the cell population shifted in morphospace in a reproducible, state-specific manner, allowing us to distinguish functional states solely from their dynamic morphology.</p>
<br>
<h4>Concept: Morphodynamics as a readout of functional state</h4>
<br>
<p>Conceptually, we show that RTMs explore a constrained morphodynamic repertoire: under challenge, they do not invent entirely new behaviors but move within or along the boundaries of a pre-existing naïve morphospace, suggesting that functional plasticity is implemented as biased sampling of this repertoire rather than wholesale reprogramming. By quantifying features such as cell area, elongation, branching, and temporal fluctuations, and combining them in a computational pipeline, we can classify macrophage states associated with inflammation or trafficking defects without relying on transcriptional or surface marker data. Importantly, when we looked at aged animals, their RTMs showed a dramatically shifted naïve morphospace, indicating that “baseline” macrophage behavior in old tissues is fundamentally different, and that this difference is visible directly in how cells move and shape-shift in vivo.</p>
<br>
<h4>Why this matters clinically...</h4>
<br>
<p>Clinically, this work hints at morphodynamic profiling as a functional biomarker of tissue health and immune aging: instead of (or alongside) bulk transcriptional signatures, we could one day classify patient macrophage states from explanted or minimally invasive tissue imaging using a standardized morphospace reference. The same framework could be used to screen drugs that “rejuvenate” macrophage behavior in aged or chronically inflamed tissues, or to optimize ex vivo tissue culture conditions by asking a simple question: do the RTMs move and shape-shift like they do in their native niche? In the longer term, these quantitative descriptors could be integrated with computational models and AI-based classifiers to support precision immunomonitoring in conditions such as chronic inflammation, fibrosis, or immunotherapy response, where macrophage dysfunction is central but hard to capture with static markers alone.</p>`,
                    media: []
                }
            ]
        },

        // ========================================
        // GALLERY
        // ========================================
        gallery: [
            // Add gallery images here when available
            // { image: "images/gallery1.jpg", caption: "Title", description: "Description" }
        ],

        // ========================================
        // FOOTER INFORMATION
        // ========================================
        footer: {
            copyright: "© 2025 Uderhardt Lab. All rights reserved.",
            affiliation: "Friedrich-Alexander-Universität Erlangen-Nürnberg",
            legal: [
                {
                    title: "External Links Disclaimer",
                    text: "Our website contains links to external websites. We have no control over the content of these sites and cannot accept any liability for them."
                },
                {
                    title: "Liability for Content",
                    text: "The content of our pages has been created with the utmost care. However, we cannot guarantee the accuracy, completeness, or topicality of the content."
                },
                {
                    title: "Copyright",
                    text: "The content and works created on these pages are subject to German copyright law. Duplication, processing, distribution, or any form of commercialization requires written consent."
                },
                {
                    title: "Privacy",
                    text: "This website does not collect personal data. No cookies are used for tracking purposes. External fonts are loaded from Google Fonts."
                }
            ]
        }
    };

    /* ============================================
       RENDERING FUNCTIONS
       (No need to edit below this line)
       ============================================ */

    // Render News Section
    function renderNews() {
        const newsGrid = document.getElementById('newsGrid');
        if (!CONFIG.news || CONFIG.news.length === 0) {
            document.getElementById('news').style.display = 'none';
            return;
        }
        newsGrid.innerHTML = CONFIG.news.map((item, i) => {
            const linkHtml = item.url ? `<a href="${item.url}" target="_blank" rel="noopener" class="news-link">Read more →</a>` : '';
            return `
                <div class="news-card reveal delay-${(i % 3) + 1}">
                    ${item.tag ? `<span class="news-tag">${item.tag}</span>` : ''}
                    <div class="news-date">${item.date}</div>
                    <h3 class="news-title">${item.title}</h3>
                    <p class="news-excerpt">${item.excerpt}</p>
                    ${linkHtml}
                </div>
            `;
        }).join('');
    }

    // Render Gallery Section
    let currentLightboxIndex = 0;

    function renderGallery() {
        const galleryGrid = document.getElementById('galleryGrid');
        if (!CONFIG.gallery || CONFIG.gallery.length === 0) {
            document.getElementById('gallery').style.display = 'none';
            return;
        }
        galleryGrid.innerHTML = CONFIG.gallery.map((item, i) => `
            <div class="gallery-item" onclick="openLightbox(${i})">
                <img src="${item.image}" alt="${item.caption}" loading="lazy">
                <div class="gallery-overlay">
                    <div class="gallery-caption">${item.caption}</div>
                    ${item.description ? `<div class="gallery-description">${item.description}</div>` : ''}
                </div>
            </div>
        `).join('');
    }

    function openLightbox(index) {
        currentLightboxIndex = index;
        const item = CONFIG.gallery[index];
        document.getElementById('lightboxImage').src = item.image;
        document.getElementById('lightboxCaption').innerHTML = `<strong>${item.caption}</strong>${item.description ? '<br>' + item.description : ''}`;
        document.getElementById('lightbox').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        document.getElementById('lightbox').classList.remove('active');
        document.body.style.overflow = '';
    }

    function navigateLightbox(direction) {
        currentLightboxIndex += direction;
        if (currentLightboxIndex < 0) currentLightboxIndex = CONFIG.gallery.length - 1;
        if (currentLightboxIndex >= CONFIG.gallery.length) currentLightboxIndex = 0;
        openLightbox(currentLightboxIndex);
    }

    // Lightbox keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (!document.getElementById('lightbox').classList.contains('active')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft') navigateLightbox(-1);
        if (e.key === 'ArrowRight') navigateLightbox(1);
    });

    // Render Hero Section
    function renderHero() {
        const labelEl = document.getElementById('heroLabel');
        const titleEl = document.getElementById('heroTitle');
        const subtitleEl = document.getElementById('heroSubtitle');

        labelEl.textContent = CONFIG.hero.label;
        titleEl.textContent = CONFIG.hero.title;
        subtitleEl.textContent = CONFIG.hero.subtitle;

        // Apply dynamic styles
        const h = CONFIG.hero;

        // Label styling
        if (h.labelSize) labelEl.style.fontSize = `${h.labelSize}rem`;
        if (h.labelColor) labelEl.style.color = h.labelColor;

        // Title styling (gradient)
        if (h.titleSize) titleEl.style.fontSize = `clamp(2rem, 8vw, ${h.titleSize}rem)`;
        if (h.titleColor1 && h.titleColor2 && h.titleColor3) {
            titleEl.style.background = `linear-gradient(135deg, ${h.titleColor1} 0%, ${h.titleColor2} 50%, ${h.titleColor3} 100%)`;
            titleEl.style.backgroundSize = '200% 200%';
            titleEl.style.webkitBackgroundClip = 'text';
            titleEl.style.webkitTextFillColor = 'transparent';
            titleEl.style.backgroundClip = 'text';
        }

        // Subtitle styling
        if (h.subtitleSize) subtitleEl.style.fontSize = `clamp(0.9rem, 2.5vw, ${h.subtitleSize}rem)`;
        if (h.subtitleColor) subtitleEl.style.color = h.subtitleColor;

        // Font styling
        if (h.labelFont) labelEl.style.fontFamily = `'${h.labelFont}', sans-serif`;
        if (h.titleFont) titleEl.style.fontFamily = `'${h.titleFont}', sans-serif`;
        if (h.subtitleFont) subtitleEl.style.fontFamily = `'${h.subtitleFont}', sans-serif`;

        // Set hero background image from config
        const heroBg = document.querySelector('.hero-bg');
        if (heroBg && CONFIG.images && CONFIG.images.hero) {
            heroBg.style.backgroundImage = `url('${CONFIG.images.hero}')`;
        }
    }

    // Render Research Section
    function renderResearch() {
        document.getElementById('researchTitle').textContent = CONFIG.research.title;
        document.getElementById('researchIntro').textContent = CONFIG.research.intro;

        const cardsContainer = document.getElementById('researchCards');
        cardsContainer.innerHTML = CONFIG.research.areas.map((area, i) => {
            const hasDetail = area.detail && area.detail.trim();
            const clickableClass = hasDetail ? 'clickable' : '';
            const onClick = hasDetail ? `onclick="openResearchModal(${i})"` : '';
            return `
                <div class="research-card ${clickableClass} reveal delay-${i + 2}" ${onClick}>
                    <div class="research-card-icon">${area.icon}</div>
                    <h3>${area.title}</h3>
                    <p>${area.text}</p>
                </div>
            `;
        }).join('');
    }

    // Modal functions
    function openResearchModal(index) {
        const area = CONFIG.research.areas[index];
        document.getElementById('modalIcon').textContent = area.icon;
        document.getElementById('modalTitle').textContent = area.title;
        document.getElementById('modalBody').innerHTML = area.detail || area.text;
        document.getElementById('researchModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        document.getElementById('researchModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    // Close modal on overlay click
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('researchModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });
        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    });

    // Generate Cell Avatar SVG
    function generateCellAvatar(type) {
        const cellConfigs = {
            pi: {
                cellGrad: 'piCellGrad',
                nucleusGrad: 'piNucleusGrad',
                filter: 'glowPi',
                nucleusRx: 20,
                nucleusRy: 18,
                vesicles: [
                    { cx: 72, cy: 32, r: 9 },
                    { cx: 28, cy: 70, r: 8 }
                ],
                vesicleColor: 'rgba(212, 165, 165, 0.7)'
            },
            postdoc: {
                cellGrad: 'postdocCellGrad',
                nucleusGrad: 'postdocNucleusGrad',
                filter: 'glowPostdoc',
                nucleusRx: 18,
                nucleusRy: 16,
                vesicles: [
                    { cx: 70, cy: 30, r: 7 },
                    { cx: 75, cy: 65, r: 6 },
                    { cx: 25, cy: 35, r: 6 },
                    { cx: 30, cy: 72, r: 7 }
                ],
                vesicleColor: 'rgba(212, 184, 150, 0.7)'
            },
            technician: {
                cellGrad: 'techCellGrad',
                nucleusGrad: 'techNucleusGrad',
                filter: 'glowTech',
                nucleusRx: 16,
                nucleusRy: 14,
                vesicles: [
                    { cx: 70, cy: 28, r: 6 },
                    { cx: 76, cy: 60, r: 5 },
                    { cx: 24, cy: 32, r: 5 },
                    { cx: 28, cy: 68, r: 6 }
                ],
                vesicleColor: 'rgba(165, 196, 184, 0.7)'
            },
            phd: {
                cellGrad: 'phdCellGrad',
                nucleusGrad: 'phdNucleusGrad',
                filter: 'glowPhd',
                nucleusRx: 16,
                nucleusRy: 14,
                vesicles: [
                    { cx: 68, cy: 25, r: 3 },
                    { cx: 75, cy: 35, r: 2 },
                    { cx: 78, cy: 55, r: 3 },
                    { cx: 72, cy: 70, r: 2 },
                    { cx: 25, cy: 28, r: 2 },
                    { cx: 22, cy: 42, r: 3 },
                    { cx: 28, cy: 65, r: 2 },
                    { cx: 35, cy: 75, r: 3 },
                    { cx: 55, cy: 78, r: 2 },
                    { cx: 62, cy: 22, r: 2 }
                ],
                vesicleColor: 'rgba(165, 184, 212, 0.7)'
            }
        };

        const cfg = cellConfigs[type] || cellConfigs.phd;

        const vesiclesSvg = cfg.vesicles.map((v, i) =>
            `<circle class="cell-organelle" fill="${cfg.vesicleColor}" cx="${v.cx}" cy="${v.cy}" r="${v.r}" style="animation-delay: ${i * 0.3}s;"/>`
        ).join('');

        return `
            <svg viewBox="0 0 100 100" class="cell-avatar">
                <path class="cell-blob" fill="url(#${cfg.cellGrad})" filter="url(#${cfg.filter})"
                    d="M 50 8 C 78 6, 94 22, 92 50 C 95 75, 80 92, 52 94 C 25 97, 8 80, 6 52 C 3 25, 20 10, 50 8"/>
                <ellipse class="cell-nucleus" fill="url(#${cfg.nucleusGrad})" cx="48" cy="48" rx="${cfg.nucleusRx}" ry="${cfg.nucleusRy}"/>
                ${vesiclesSvg}
            </svg>
        `;
    }

    // Render Team Section
    function renderTeam() {
        const teamGrid = document.getElementById('teamGrid');
        teamGrid.innerHTML = CONFIG.team.map((member, i) => {
            // Build profile links if any exist
            let linksHtml = '';
            const hasLinks = member.googleScholar || member.linkedin || member.researchGate || member.github || member.orcid || member.website;
            if (hasLinks) {
                linksHtml = '<div class="team-links">';
                if (member.googleScholar) {
                    linksHtml += `<a href="${member.googleScholar}" target="_blank" rel="noopener" class="team-link" title="Google Scholar">
                        <svg viewBox="0 0 24 24"><path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/></svg>
                    </a>`;
                }
                if (member.linkedin) {
                    linksHtml += `<a href="${member.linkedin}" target="_blank" rel="noopener" class="team-link" title="LinkedIn">
                        <svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                    </a>`;
                }
                if (member.researchGate) {
                    linksHtml += `<a href="${member.researchGate}" target="_blank" rel="noopener" class="team-link" title="ResearchGate">
                        <svg viewBox="0 0 24 24"><path d="M19.586 0c-.818 0-1.508.19-2.073.565-.563.377-.97.936-1.213 1.68a3.193 3.193 0 0 0-.112.437 8.365 8.365 0 0 0-.078.53 9 9 0 0 0-.05.727c-.01.282-.013.621-.013 1.016a31.121 31.121 0 0 0 .014 1.017 9 9 0 0 0 .05.727 7.946 7.946 0 0 0 .078.53h-.005a3.334 3.334 0 0 0 .112.44c.244.743.65 1.303 1.214 1.68.565.376 1.256.564 2.075.564.8 0 1.536-.213 2.105-.603.57-.39.94-.916 1.175-1.65.076-.235.135-.558.177-.93a10.9 10.9 0 0 0 .043-1.207v-.82c0-.095-.047-.142-.14-.142h-3.064c-.094 0-.14.047-.14.141v.956c0 .094.046.14.14.14h1.666c.056 0 .084.03.084.086 0 .36 0 .62-.036.865-.038.244-.1.447-.147.606-.108.335-.311.622-.575.82-.263.2-.686.31-1.2.31-.507 0-.946-.105-1.232-.296-.287-.19-.503-.478-.645-.855a3.28 3.28 0 0 1-.113-.44 8.544 8.544 0 0 1-.078-.53 9.313 9.313 0 0 1-.05-.727c-.013-.282-.02-.621-.02-1.017s.007-.735.02-1.016a9 9 0 0 1 .05-.727 7.946 7.946 0 0 1 .078-.53 3.28 3.28 0 0 1 .113-.44c.142-.376.358-.664.645-.855.286-.19.725-.295 1.232-.295.347 0 .623.045.826.138.203.09.37.214.502.368.13.153.227.322.288.506.06.183.09.38.09.584 0 .094.047.14.14.14h1.666c.094 0 .14-.046.14-.14a3.158 3.158 0 0 0-.174-.965 2.922 2.922 0 0 0-.534-.89 2.862 2.862 0 0 0-.926-.665c-.38-.18-.848-.27-1.403-.27-.68 0-1.27.147-1.768.44a2.718 2.718 0 0 0-1.07 1.178h-.005v-1.31c0-.093-.047-.14-.14-.14H15.79c-.093 0-.14.047-.14.14v9.48c0 .094.047.14.14.14h1.49c.094 0 .14-.046.14-.14v-3.58h.01a2.854 2.854 0 0 0 1.135 1.274c.517.324 1.147.487 1.89.487.717 0 1.344-.163 1.882-.488a3.16 3.16 0 0 0 1.227-1.41c.288-.616.432-1.36.432-2.23 0-.874-.144-1.617-.432-2.232a3.16 3.16 0 0 0-1.227-1.41c-.538-.324-1.165-.487-1.883-.487zm-9.5 3.085c-.893 0-1.63.242-2.21.725-.58.483-.95 1.126-1.11 1.927h-.005l-.005.03h-.005v.02h-.005v.01h-.005v.01h-.005v.02h-.005v.01h-.005v.02h-.01v.01h-.005v.03h-.005v.01h-.005v.03h-.01l-.01.03v.02l-.005.01v.03l-.005.01v.03l-.005.02v.01l-.005.03v.02l-.005.01v.03l-.005.02v.02l-.005.03v5.82c0 .094.046.14.14.14h1.498c.093 0 .14-.046.14-.14V9.2c0-.142.01-.276.03-.402.023-.126.058-.242.107-.348.098-.212.255-.384.47-.515.216-.13.507-.197.871-.197.36 0 .647.065.86.196.213.13.363.295.45.497.09.202.14.427.152.673v5.64c0 .093.046.14.14.14h1.49c.093 0 .14-.047.14-.14V8.902c0-.438-.065-.835-.196-1.19a2.46 2.46 0 0 0-.587-.914 2.586 2.586 0 0 0-.96-.586 3.67 3.67 0 0 0-1.313-.227zM4.448 3.085c-.446 0-.87.054-1.27.162-.4.108-.77.27-1.11.488a3.07 3.07 0 0 0-.866.815c-.23.326-.393.713-.49 1.16h-.005l-.005.03h-.005v.02h-.005v.015h-.01v.02h-.01l-.005.025-.005.025v.01l-.005.02-.005.025h-.005l-.005.02-.005.02v.01l-.01.04v.02l-.01.02v.03l-.005.01v.03l-.005.01v.03l-.005.02v.02l-.005.02v.03l-.005.02v.13c0 .094.046.14.14.14h1.498c.093 0 .14-.046.14-.14v-.06c0-.06.008-.12.02-.177.01-.056.03-.11.05-.16.043-.1.11-.19.2-.27a1 1 0 0 1 .32-.187 1.18 1.18 0 0 1 .39-.065c.14 0 .265.022.378.065.11.043.207.103.287.18.08.077.14.17.18.276a.954.954 0 0 1 .06.34c0 .12-.02.232-.055.337a.926.926 0 0 1-.17.297 1.23 1.23 0 0 1-.32.262c-.135.08-.303.156-.508.228-.5.173-.93.358-1.293.553a2.9 2.9 0 0 0-.89.697c-.233.273-.4.583-.502.93-.103.346-.155.733-.155 1.16 0 .377.05.73.152 1.056.1.326.26.612.474.855.216.244.487.436.816.577.328.14.715.21 1.16.21.373 0 .73-.054 1.07-.163.338-.108.647-.27.927-.487h.01v.37c0 .093.047.14.14.14h1.49c.093 0 .14-.047.14-.14V7.493c0-.47-.074-.886-.222-1.247a2.417 2.417 0 0 0-.645-.93 2.79 2.79 0 0 0-1.02-.58 4.3 4.3 0 0 0-1.347-.197zm.135 3.753c.218.02.39.076.518.167.13.09.222.207.28.35.06.144.09.31.09.502v2.203a2.1 2.1 0 0 1-.53.336c-.21.09-.442.136-.693.136-.25 0-.464-.04-.643-.12a1.03 1.03 0 0 1-.413-.33 1.31 1.31 0 0 1-.218-.49 2.542 2.542 0 0 1-.063-.576c0-.232.022-.437.067-.615.045-.177.115-.328.21-.45.097-.124.22-.22.37-.29.15-.068.333-.11.55-.125l.077-.005.07-.002c.076-.002.18.003.328.012z"/></svg>
                    </a>`;
                }
                if (member.github) {
                    linksHtml += `<a href="${member.github}" target="_blank" rel="noopener" class="team-link" title="GitHub">
                        <svg viewBox="0 0 24 24"><path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
                    </a>`;
                }
                if (member.orcid) {
                    linksHtml += `<a href="${member.orcid}" target="_blank" rel="noopener" class="team-link" title="ORCID">
                        <svg viewBox="0 0 24 24"><path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zM7.369 4.378c.525 0 .947.431.947.947s-.422.947-.947.947a.95.95 0 0 1-.947-.947c0-.525.422-.947.947-.947zm-.722 3.038h1.444v10.041H6.647V7.416zm3.562 0h3.9c3.712 0 5.344 2.653 5.344 5.025 0 2.578-2.016 5.025-5.325 5.025h-3.919V7.416zm1.444 1.303v7.444h2.297c3.272 0 4.022-2.484 4.022-3.722 0-2.016-1.284-3.722-4.097-3.722h-2.222z"/></svg>
                    </a>`;
                }
                if (member.website) {
                    const label = member.websiteLabel || 'Website';
                    linksHtml += `<a href="${member.website}" target="_blank" rel="noopener" class="team-link" title="${label}">
                        <svg viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm1 16.057v-3.057h2.994c-.059 1.143-.212 2.24-.456 3.279-.823-.12-1.674-.188-2.538-.222zm1.957 2.162c-.499 1.33-1.159 2.497-1.957 3.456v-3.62c.666.028 1.319.081 1.957.164zm-1.957-7.219v-3.015c.868-.034 1.721-.103 2.548-.224.238 1.027.389 2.111.446 3.239H13zm0-5.014v-3.661c.806.969 1.471 2.15 1.971 3.496-.642.084-1.3.137-1.971.165zm2.703-3.267c1.237.496 2.354 1.228 3.29 2.146-.642.234-1.311.442-2.019.607-.344-.992-.775-1.91-1.271-2.753zm-.69 1.679c.535.96.993 2.025 1.349 3.164-.934.142-1.913.236-2.939.272v-3.194c.561.032 1.108.086 1.59.158zm-4.013.395v3.036h-3.494c.058-1.126.21-2.209.448-3.232.836.124 1.7.193 2.58.228l.466-.032zm-2.053-3.587c-.494.837-.926 1.748-1.274 2.73-.708-.163-1.377-.373-2.018-.607.937-.918 2.053-1.65 3.292-2.123zm-4.182 3.655c.696.236 1.428.445 2.185.618-.349 1.139-.583 2.361-.649 3.634H2.284c.192-1.629.754-3.146 1.607-4.462l.384.21zm-.17 6.462H5.51c.067 1.272.3 2.495.649 3.634-.757.173-1.489.383-2.185.617-.853-1.315-1.415-2.832-1.607-4.461l.248.21zm2.354 5.282c.641-.234 1.31-.443 2.018-.607.347.98.78 1.892 1.274 2.73-1.239-.473-2.355-1.205-3.292-2.123zm2.771-1.532c-.934-.142-1.913-.236-2.939-.272v-3.194c.561.032 1.109-.016 1.59-.088.348 1.139.806 2.204 1.349 3.164.009.19.009.39.009.39h-.009zm1.895 4.318v-3.661c.671.028 1.329.081 1.971.165-.5 1.346-1.165 2.527-1.971 3.496zm5.954-3.267c-.936.918-2.053 1.65-3.29 2.146.496-.843.927-1.761 1.271-2.753.708.165 1.377.373 2.019.607zm-2.771-1.532c-.356-1.14-.814-2.205-1.349-3.164.481-.072 1.03-.126 1.59-.158v3.05c-1.026.036-2.006.13-2.939.272h.698zm4.182-3.655c-.696-.235-1.428-.445-2.185-.618.349-1.139.583-2.361.649-3.634h3.493c-.192 1.629-.754 3.146-1.607 4.462l-.35-.21z"/></svg>
                    </a>`;
                }
                linksHtml += '</div>';
            }
            return `
            <div class="team-member reveal delay-${(i % 4) + 1}">
                ${generateCellAvatar(member.type)}
                <h3 class="team-name">${member.name}</h3>
                <p class="team-role">${member.role}</p>
                ${linksHtml}
            </div>
        `;
        }).join('');
    }

    // Render Funding Section
    function renderFunding() {
        const fundingGrid = document.getElementById('fundingGrid');
        fundingGrid.innerHTML = CONFIG.funders.map((funder, i) => {
            const hasUrl = funder.url && funder.url.trim();
            const wrapperStart = hasUrl ? `<a href="${funder.url}" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">` : '';
            const wrapperEnd = hasUrl ? '</a>' : '';
            const linkClass = hasUrl ? 'has-link' : '';
            return `
                ${wrapperStart}
                <div class="funding-card ${linkClass} reveal delay-${(i % 4) + 1}">
                    <div class="funding-icon">${funder.icon}</div>
                    <h3 class="funding-name">${funder.name}</h3>
                    <p class="funding-program">${funder.program}</p>
                </div>
                ${wrapperEnd}
            `;
        }).join('');
    }

    // Highlight author name
    function highlightAuthor(authors) {
        return authors.replace(/Uderhardt S/g, '<span class="highlight">Uderhardt S</span>');
    }

    // Render Stats Section
    function renderStats() {
        const pubStats = document.getElementById('pubStats');
        const scholarLink = CONFIG.stats.scholarUrl
            ? `<a href="${CONFIG.stats.scholarUrl}" target="_blank" rel="noopener" class="scholar-link">View on Google Scholar →</a>`
            : '';
        pubStats.innerHTML = `
            <div class="pub-stat">
                <div class="pub-stat-number">${CONFIG.stats.publications}</div>
                <div class="pub-stat-label">Publications</div>
            </div>
            <div class="pub-stat">
                <div class="pub-stat-number">${CONFIG.stats.citations}</div>
                <div class="pub-stat-label">Citations</div>
            </div>
            <div class="pub-stat">
                <div class="pub-stat-number">${CONFIG.stats.hIndex}</div>
                <div class="pub-stat-label">h-index</div>
            </div>
            ${scholarLink ? `<div class="pub-stat-link">${scholarLink}</div>` : ''}
        `;
    }

    // Render Publications Section
    // Store publications for modal access
    let allPublications = [];

    function renderPublications() {
        const pubTimeline = document.getElementById('pubTimeline');
        const years = Object.keys(CONFIG.publications).sort((a, b) => b - a);

        // Flatten publications for modal access
        allPublications = [];
        let pubIndex = 0;

        pubTimeline.innerHTML = years.map(year => `
            <div class="pub-year">
                <div class="pub-year-marker"></div>
                <div class="pub-year-label">${year}</div>
                ${CONFIG.publications[year].map(pub => {
                    const idx = pubIndex++;
                    allPublications.push(pub);

                    // Build links
                    let linksHtml = '<div class="pub-item-links">';
                    if (pub.publisherUrl) {
                        linksHtml += `<a href="${pub.publisherUrl}" target="_blank" rel="noopener" class="pub-item-link">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                            Publisher
                        </a>`;
                    }
                    if (pub.depositUrl) {
                        linksHtml += `<a href="${pub.depositUrl}" target="_blank" rel="noopener" class="pub-item-link">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z"/></svg>
                            Deposit
                        </a>`;
                    }
                    if (pub.codeUrl) {
                        linksHtml += `<a href="${pub.codeUrl}" target="_blank" rel="noopener" class="pub-item-link">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                            Code
                        </a>`;
                    }
                    // Add details button if there's extra content
                    const hasDetails = pub.graphicalAbstract || pub.description || (pub.media && pub.media.length > 0);
                    if (hasDetails) {
                        linksHtml += `<button class="pub-item-link pub-details-btn" onclick="openPublicationModal(${idx})">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                            Details
                        </button>`;
                    }
                    linksHtml += '</div>';

                    const hasAnyLinks = pub.publisherUrl || pub.depositUrl || pub.codeUrl || hasDetails;

                    return `
                        <div class="pub-item">
                            <h4>${pub.title}</h4>
                            <p class="authors">${highlightAuthor(pub.authors)}</p>
                            <p class="journal">${pub.journal}</p>
                            ${hasAnyLinks ? linksHtml : ''}
                        </div>
                    `;
                }).join('')}
            </div>
        `).join('');
    }

    // Publication Modal Functions
    function openPublicationModal(index) {
        const pub = allPublications[index];
        if (!pub) return;

        document.getElementById('pubModalTitle').textContent = pub.title;
        document.getElementById('pubModalJournal').textContent = pub.journal;

        // Graphical abstract
        const abstractImg = document.getElementById('pubModalAbstract');
        if (pub.graphicalAbstract) {
            abstractImg.src = pub.graphicalAbstract;
            abstractImg.classList.add('visible');
        } else {
            abstractImg.classList.remove('visible');
        }

        // Description
        document.getElementById('pubModalDescription').innerHTML = pub.description || '';

        // Media gallery
        const mediaGallery = document.getElementById('pubModalMedia');
        if (pub.media && pub.media.length > 0) {
            mediaGallery.innerHTML = pub.media.map(item => {
                if (item.type === 'video') {
                    return `<video src="${item.url}" controls></video>`;
                } else {
                    return `<img src="${item.url}" alt="${item.caption || ''}">`;
                }
            }).join('');
        } else {
            mediaGallery.innerHTML = '';
        }

        // Links
        let modalLinks = '';
        if (pub.publisherUrl) {
            modalLinks += `<a href="${pub.publisherUrl}" target="_blank" rel="noopener" class="pub-link">Publisher</a>`;
        }
        if (pub.depositUrl) {
            modalLinks += `<a href="${pub.depositUrl}" target="_blank" rel="noopener" class="pub-link">Deposit</a>`;
        }
        if (pub.codeUrl) {
            modalLinks += `<a href="${pub.codeUrl}" target="_blank" rel="noopener" class="pub-link">Code</a>`;
        }
        document.getElementById('pubModalLinks').innerHTML = modalLinks;

        // Show modal
        document.getElementById('pubModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closePublicationModal() {
        document.getElementById('pubModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closePublicationModal();
    });

    // Close modal on background click
    document.getElementById('pubModal')?.addEventListener('click', (e) => {
        if (e.target.id === 'pubModal') closePublicationModal();
    });

    // Render Footer
    function renderFooter() {
        const footerLegal = document.getElementById('footerLegal');
        footerLegal.innerHTML = CONFIG.footer.legal.map(item => `
            <div class="footer-legal-item">
                <h4>${item.title}</h4>
                <p>${item.text}</p>
            </div>
        `).join('');

        document.getElementById('footerCopyright').textContent = CONFIG.footer.copyright;
        document.getElementById('footerAffiliation').textContent = CONFIG.footer.affiliation;
    }

    /* ============================================
       VISUAL EFFECTS & INTERACTIONS
       ============================================ */

    // Particles Background
    function initParticles() {
        const canvas = document.getElementById('particles');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function createParticles() {
            const count = Math.min(100, Math.floor((canvas.width * canvas.height) / 15000));
            particles = [];
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 2 + 1,
                    opacity: Math.random() * 0.5 + 0.2
                });
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;

                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(168, 85, 247, ${p.opacity})`;
                ctx.fill();

                // Connect nearby particles
                for (let j = i + 1; j < particles.length; j++) {
                    const p2 = particles[j];
                    const dx = p.x - p2.x;
                    const dy = p.y - p2.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 100) {
                        ctx.beginPath();
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.strokeStyle = `rgba(168, 85, 247, ${0.15 * (1 - dist / 100)})`;
                        ctx.stroke();
                    }
                }
            });

            requestAnimationFrame(animate);
        }

        resize();
        createParticles();
        animate();

        window.addEventListener('resize', () => {
            resize();
            createParticles();
        });
    }

    // Navigation Scroll Effect
    function initNavScroll() {
        const nav = document.getElementById('nav');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });
    }

    // Mobile Menu
    function initMobileMenu() {
        const toggle = document.getElementById('navToggle');
        const menu = document.getElementById('mobileMenu');
        const links = menu.querySelectorAll('a');

        toggle.addEventListener('click', () => {
            toggle.classList.toggle('active');
            menu.classList.toggle('active');
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        });

        links.forEach(link => {
            link.addEventListener('click', () => {
                toggle.classList.remove('active');
                menu.classList.remove('active');
                document.body.style.overflow = '';
            });
        });
    }

    // Smooth Scroll with Offset
    function initSmoothScroll() {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const navHeight = document.getElementById('nav').offsetHeight;
                    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - navHeight;
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });
    }

    // Scroll Reveal
    function initScrollReveal() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    }

    // Tap Ripple Effect (Mobile)
    function initTapRipple() {
        if ('ontouchstart' in window) {
            document.addEventListener('touchstart', (e) => {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.left = (e.touches[0].clientX - 150) + 'px';
                ripple.style.top = (e.touches[0].clientY - 150) + 'px';
                ripple.style.width = '300px';
                ripple.style.height = '300px';
                document.body.appendChild(ripple);

                setTimeout(() => ripple.remove(), 800);
            });
        }
    }

    // Hero Parallax (Gyroscope)
    function initGyroParallax() {
        const heroBg = document.getElementById('heroBg');

        if (window.DeviceOrientationEvent && 'ontouchstart' in window) {
            window.addEventListener('deviceorientation', (e) => {
                const gamma = Math.max(-15, Math.min(15, e.gamma || 0));
                const beta = Math.max(-15, Math.min(15, (e.beta || 0) - 45));

                const x = gamma * 1.5;
                const y = beta * 1.5;

                heroBg.style.transform = `translate(${x}px, ${y}px) scale(1.1)`;
            });
        }
    }

    /* ============================================
       INITIALIZATION
       ============================================ */

    // ============================================
    // ELECTRIC SIGNAL ANIMATION (Image-Based Paths)
    // ============================================
    const electricCanvas = document.getElementById('electricCanvas');
    const electricCtx = electricCanvas ? electricCanvas.getContext('2d') : null;
    let electricWidth, electricHeight;
    let signals = [];

    // Brightness map for image-based pathfinding
    let brightnessMap = null;
    let mapWidth = 0;
    let mapHeight = 0;
    let imgOriginalWidth = 0;
    let imgOriginalHeight = 0;
    const MAP_SCALE = 4; // Sample every 4th pixel for performance

    // Cover-mode mapping variables (recalculated on resize)
    let coverScale = 1;
    let coverOffsetX = 0;
    let coverOffsetY = 0;

    function updateCoverMapping() {
        if (!imgOriginalWidth || !imgOriginalHeight) return;

        // Calculate scale to cover viewport (same as CSS background-size: cover)
        const scaleX = electricWidth / imgOriginalWidth;
        const scaleY = electricHeight / imgOriginalHeight;
        coverScale = Math.max(scaleX, scaleY);

        // Calculate centered offset (overflow is cropped equally from both sides)
        const scaledWidth = imgOriginalWidth * coverScale;
        const scaledHeight = imgOriginalHeight * coverScale;
        coverOffsetX = (scaledWidth - electricWidth) / 2;
        coverOffsetY = (scaledHeight - electricHeight) / 2;
    }

    function resizeElectricCanvas() {
        if (!electricCanvas) return;
        // Use hero section dimensions instead of window to match background-size: cover
        const hero = document.querySelector('.hero');
        if (hero) {
            electricWidth = electricCanvas.width = hero.offsetWidth;
            electricHeight = electricCanvas.height = hero.offsetHeight;
        } else {
            electricWidth = electricCanvas.width = window.innerWidth;
            electricHeight = electricCanvas.height = window.innerHeight;
        }
        updateCoverMapping();
    }

    // Load hero image and create brightness map
    function createBrightnessMap(imageSrc) {
        return new Promise((resolve) => {
            const img = new Image();

            const processImage = () => {
                // Store original dimensions for cover mapping
                imgOriginalWidth = img.width;
                imgOriginalHeight = img.height;
                updateCoverMapping();

                // Create offscreen canvas
                const offCanvas = document.createElement('canvas');
                mapWidth = Math.floor(img.width / MAP_SCALE);
                mapHeight = Math.floor(img.height / MAP_SCALE);
                offCanvas.width = mapWidth;
                offCanvas.height = mapHeight;

                const offCtx = offCanvas.getContext('2d');
                offCtx.drawImage(img, 0, 0, mapWidth, mapHeight);

                try {
                    const imageData = offCtx.getImageData(0, 0, mapWidth, mapHeight);
                    const data = imageData.data;

                    // Create brightness array
                    brightnessMap = new Float32Array(mapWidth * mapHeight);
                    let minB = 1, maxB = 0;

                    for (let i = 0; i < brightnessMap.length; i++) {
                        const idx = i * 4;
                        // Luminance formula
                        const b = (data[idx] * 0.299 + data[idx + 1] * 0.587 + data[idx + 2] * 0.114) / 255;
                        brightnessMap[i] = b;
                        minB = Math.min(minB, b);
                        maxB = Math.max(maxB, b);
                    }

                    // Normalize brightness to use full 0-1 range
                    const range = maxB - minB;
                    if (range > 0.01) {
                        for (let i = 0; i < brightnessMap.length; i++) {
                            brightnessMap[i] = (brightnessMap[i] - minB) / range;
                        }
                    }

                    console.log('Brightness map created:', mapWidth, 'x', mapHeight, '| Range:', minB.toFixed(2), '-', maxB.toFixed(2));
                    resolve(true);
                } catch (e) {
                    console.warn('CORS blocked image reading. To fix: run a local server (python3 -m http.server)');
                    console.log('Falling back to random paths');
                    resolve(false);
                }
            };

            img.onload = processImage;
            img.onerror = () => {
                console.log('Image load failed, using random paths');
                resolve(false);
            };

            // Try without crossOrigin first (works for same-origin)
            img.src = imageSrc;
        });
    }

    // Debug: visualize the brightness map (with cover mapping like hero image)
    function debugShowBrightnessMap() {
        if (!brightnessMap) {
            console.log('No brightness map available');
            return;
        }
        // Pause animation
        animationRunning = false;
        electricCtx.clearRect(0, 0, electricWidth, electricHeight);

        // Draw using the same cover mapping as the hero image
        const step = 2; // Sample every 2 pixels for speed
        for (let screenY = 0; screenY < electricHeight; screenY += step) {
            for (let screenX = 0; screenX < electricWidth; screenX += step) {
                const b = getBrightness(screenX, screenY);
                if (b > 0.1) {
                    electricCtx.fillStyle = `rgba(168, 85, 247, ${b})`;
                    electricCtx.fillRect(screenX, screenY, step, step);
                }
            }
        }
        console.log('Debug: brightness map visualized with cover mapping. Purple = paths. Type resumeAnimation() to continue.');
    }

    function resumeAnimation() {
        animationRunning = true;
        animateElectric();
        console.log('Animation resumed.');
    }
    // Expose for console: debugShowBrightnessMap(), resumeAnimation()

    // Get brightness at screen position (0-1), accounting for background-size: cover
    function getBrightness(screenX, screenY) {
        if (!brightnessMap) return 0.5;

        // Convert screen coords to image coords (accounting for cover crop/scale)
        const imgX = (screenX + coverOffsetX) / coverScale;
        const imgY = (screenY + coverOffsetY) / coverScale;

        // Convert to map coords
        const mapX = Math.floor(imgX / MAP_SCALE);
        const mapY = Math.floor(imgY / MAP_SCALE);

        if (mapX < 0 || mapX >= mapWidth || mapY < 0 || mapY >= mapHeight) return 0;

        return brightnessMap[mapY * mapWidth + mapX];
    }

    // Find best direction to follow path (look-ahead approach)
    function findBestDirection(x, y, currentAngle, lookAhead = 60) {
        if (!brightnessMap) return { angle: currentAngle + (Math.random() - 0.5) * 0.3, onPath: false };

        const currentBrightness = getBrightness(x, y);
        const onPath = currentBrightness > 0.3;

        // Sample directions to find continuous path
        const samples = 20;
        const spread = Math.PI * 0.9; // Look within ~80 degrees of current direction

        let bestAngle = currentAngle;
        let bestScore = -1;

        for (let i = 0; i < samples; i++) {
            const angleOffset = ((i / (samples - 1)) - 0.5) * spread;
            const testAngle = currentAngle + angleOffset;

            // Check path continuity - all points must be on path
            let score = 0;
            let continuous = true;

            for (let dist = 5; dist <= lookAhead; dist += 5) {
                const testX = x + Math.cos(testAngle) * dist;
                const testY = y + Math.sin(testAngle) * dist;
                const b = getBrightness(testX, testY);

                // If we hit a dark spot, path is broken - heavily penalize
                if (b < 0.25) {
                    continuous = false;
                    score *= 0.1; // Massive penalty for crossing dark areas
                    break;
                }
                score += b;
            }

            // Bonus for continuous paths
            if (continuous) score *= 1.5;

            // Preference for going straight
            const straightBonus = 1 - Math.abs(angleOffset) / spread * 0.4;
            score *= straightBonus;

            if (score > bestScore) {
                bestScore = score;
                bestAngle = testAngle;
            }
        }

        return { angle: bestAngle, onPath: onPath, score: bestScore };
    }

    // Find a starting point on a path
    function findBrightSpot() {
        if (!brightnessMap) {
            return { x: Math.random() * electricWidth, y: Math.random() * electricHeight, angle: Math.random() * Math.PI * 2 };
        }

        // Try random positions until we find one on a path
        for (let i = 0; i < 100; i++) {
            const x = Math.random() * electricWidth;
            const y = Math.random() * electricHeight;
            const b = getBrightness(x, y);

            if (b > 0.5) {  // On a path (white area)
                // Find initial direction along the path
                let bestAngle = Math.random() * Math.PI * 2;
                let bestScore = 0;
                for (let a = 0; a < 8; a++) {
                    const angle = (a / 8) * Math.PI * 2;
                    const testX = x + Math.cos(angle) * 30;
                    const testY = y + Math.sin(angle) * 30;
                    const score = getBrightness(testX, testY);
                    if (score > bestScore) {
                        bestScore = score;
                        bestAngle = angle;
                    }
                }
                return { x, y, angle: bestAngle };
            }
        }

        // Fallback
        return { x: electricWidth / 2, y: electricHeight / 2, angle: Math.random() * Math.PI * 2 };
    }

    class SignalPulse {
        constructor() {
            this.reset();
        }

        reset() {
            // Start on a path with direction along it
            const start = findBrightSpot();
            this.x = start.x;
            this.y = start.y;
            this.angle = start.angle;

            const cfg = CONFIG.pulses || { speed: 2, size: 1, length: 10, sparkle: 5, hue: 45 };
            this.speed = (cfg.speed * 0.4) + Math.random() * (cfg.speed * 1.2);
            this.trail = [];
            this.maxTrail = Math.floor(cfg.length * 0.7) + Math.floor(Math.random() * cfg.length * 0.6);
            // Vary initial life so comets don't all die at once (staggered lifespans)
            this.life = 0.4 + Math.random() * 0.6; // Start between 40-100% life
            // Calculate decay from lifetime (in seconds) - at 60fps: decay = 1 / (lifetime * 60)
            const lifetime = cfg.lifetime || 30; // Default 30 seconds
            const baseDecay = 1 / (lifetime * 60);
            // Vary individual decay rate (±40% variation for natural feel)
            this.myLifeDecay = baseDecay * (0.6 + Math.random() * 0.8);
            const baseHue = cfg.hue !== undefined ? cfg.hue : 45;
            this.hue = baseHue + (Math.random() - 0.5) * 20; // Slight variation around base hue
            this.saturation = cfg.saturation !== undefined ? cfg.saturation : 100; // 0-100%
            this.thickness = (cfg.size * 0.6) + Math.random() * (cfg.size * 0.8);
            this.branches = [];
            this.branchChance = 0.012;
            this.sparkles = []; // Sparkling trail particles
            this.sparkleTimer = 0;
            this.sparkleRate = Math.max(1, Math.floor(6 - (cfg.sparkle || 5) * 0.5)); // Higher sparkle = more frequent
        }

        update() {
            // Find best direction by looking ahead along the path
            const direction = findBestDirection(this.x, this.y, this.angle, 80);

            // Smoothly turn toward best direction
            let angleDiff = direction.angle - this.angle;
            while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
            while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;

            // Turn quickly to follow path
            const turnSpeed = direction.onPath ? 0.35 : 0.25;
            this.angle += angleDiff * turnSpeed;

            // Minimal random variation
            this.angle += (Math.random() - 0.5) * 0.01;

            // Move
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;

            // Add to trail
            this.trail.push({ x: this.x, y: this.y, alpha: 1 });

            if (this.trail.length > this.maxTrail) {
                this.trail.shift();
            }

            this.trail.forEach((p, i) => {
                p.alpha = (i / this.trail.length) * this.life;
            });

            // Spawn sparkles along the trail
            this.sparkleTimer++;
            const sparkleIntensity = CONFIG.pulses?.sparkle || 5;
            if (this.sparkleTimer >= this.sparkleRate) {
                this.sparkleTimer = 0;
                // Add sparkles at current position with random offset
                const sparkleOffset = 8 + sparkleIntensity;
                const numSparkles = Math.ceil(sparkleIntensity / 3); // More sparkles with higher intensity
                for (let i = 0; i < numSparkles; i++) {
                    this.sparkles.push({
                        x: this.x + (Math.random() - 0.5) * sparkleOffset,
                        y: this.y + (Math.random() - 0.5) * sparkleOffset,
                        life: 1,
                        size: 1 + Math.random() * (1 + sparkleIntensity * 0.3),
                        twinkleSpeed: 0.05 + Math.random() * 0.1,
                        twinklePhase: Math.random() * Math.PI * 2
                    });
                }
            }

            // Update and fade sparkles
            const sparkleFade = CONFIG.pulses?.sparkleFade || 0.003;
            this.sparkles.forEach(s => {
                s.life -= sparkleFade;
                s.twinklePhase += s.twinkleSpeed;
            });
            this.sparkles = this.sparkles.filter(s => s.life > 0);

            // Branch occasionally when on path
            const onPath = getBrightness(this.x, this.y) > 0.5;
            if (onPath && Math.random() < this.branchChance && this.branches.length < 2) {
                this.branches.push({
                    x: this.x,
                    y: this.y,
                    angle: this.angle + (Math.random() - 0.5) * 1.5,
                    trail: [],
                    life: 0.6,
                    speed: this.speed * 0.6
                });
            }

            // Update branches (follow paths)
            this.branches.forEach(branch => {
                const branchDir = findBestDirection(branch.x, branch.y, branch.angle, 40);
                let angleDiff = branchDir.angle - branch.angle;
                while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
                branch.angle += angleDiff * 0.15;
                branch.angle += (Math.random() - 0.5) * 0.02;
                branch.x += Math.cos(branch.angle) * branch.speed;
                branch.y += Math.sin(branch.angle) * branch.speed;
                branch.trail.push({ x: branch.x, y: branch.y, alpha: branch.life });
                if (branch.trail.length > 15) branch.trail.shift();
                branch.life -= 0.015;
            });

            this.branches = this.branches.filter(b => b.life > 0);

            // General life decay (using individual rate for staggered deaths)
            this.life -= this.myLifeDecay;

            // Extra fade when leaving screen
            if (this.x < -50 || this.x > electricWidth + 50 ||
                this.y < -50 || this.y > electricHeight + 50) {
                this.life -= 0.02; // Fast fade off-screen
            }

            // Extra fade when off path
            const pathBrightness = getBrightness(this.x, this.y);
            if (pathBrightness < 0.3) {
                this.life -= 0.008;
            } else if (pathBrightness < 0.5) {
                this.life -= 0.002;
            }

            return this.life > 0;
        }

        draw() {
            // Draw sparkles first (behind the comet)
            this.sparkles.forEach(s => {
                // Twinkle effect
                const twinkle = 0.5 + 0.5 * Math.sin(s.twinklePhase);
                // Use cubic curve for smooth gradual fade (life^3 approaches 0 smoothly)
                const fadeCurve = s.life * s.life * s.life;
                const sparkleOpacity = fadeCurve * twinkle * 0.9;
                // Also shrink sparkle as it fades for smoother disappearance
                const fadeSize = s.size * (0.2 + s.life * 0.8);

                // Sparkle glow
                const sparkGrad = electricCtx.createRadialGradient(
                    s.x, s.y, 0,
                    s.x, s.y, fadeSize * 3
                );
                sparkGrad.addColorStop(0, `hsla(${this.hue + 10}, ${this.saturation}%, 95%, ${sparkleOpacity})`);
                sparkGrad.addColorStop(0.3, `hsla(${this.hue}, ${this.saturation * 0.9}%, 70%, ${sparkleOpacity * 0.6})`);
                sparkGrad.addColorStop(1, 'transparent');

                electricCtx.beginPath();
                electricCtx.arc(s.x, s.y, fadeSize * 3, 0, Math.PI * 2);
                electricCtx.fillStyle = sparkGrad;
                electricCtx.fill();

                // Bright center point (also shrinks)
                electricCtx.beginPath();
                electricCtx.arc(s.x, s.y, fadeSize * 0.5, 0, Math.PI * 2);
                electricCtx.fillStyle = `hsla(55, 100%, 95%, ${sparkleOpacity})`;
                electricCtx.fill();
            });

            if (this.trail.length > 1) {
                electricCtx.lineCap = 'round';
                electricCtx.lineJoin = 'round';

                // Draw each segment with tapering thickness and fading opacity
                for (let i = 0; i < this.trail.length - 1; i++) {
                    const p1 = this.trail[i];
                    const p2 = this.trail[i + 1];

                    // Progress: 0 at tail, 1 at head
                    const progress = i / (this.trail.length - 1);

                    // Thickness tapers from full at head to 0.1 at tail
                    const segmentThickness = this.thickness * (0.1 + progress * 0.9);

                    // Opacity fades from full at head to 0.1 at tail
                    const segmentOpacity = this.life * (0.1 + progress * 0.7);

                    // Draw outer glow (warm golden)
                    electricCtx.beginPath();
                    electricCtx.moveTo(p1.x, p1.y);
                    electricCtx.lineTo(p2.x, p2.y);
                    electricCtx.strokeStyle = `hsla(${this.hue - 5}, ${this.saturation * 0.8}%, 50%, ${segmentOpacity * 0.25})`;
                    electricCtx.lineWidth = segmentThickness + 6;
                    electricCtx.stroke();

                    // Draw middle glow
                    electricCtx.beginPath();
                    electricCtx.moveTo(p1.x, p1.y);
                    electricCtx.lineTo(p2.x, p2.y);
                    electricCtx.strokeStyle = `hsla(${this.hue}, ${this.saturation * 0.9}%, 65%, ${segmentOpacity * 0.5})`;
                    electricCtx.lineWidth = segmentThickness + 3;
                    electricCtx.stroke();

                    // Draw main trail (bright golden core)
                    electricCtx.beginPath();
                    electricCtx.moveTo(p1.x, p1.y);
                    electricCtx.lineTo(p2.x, p2.y);
                    electricCtx.strokeStyle = `hsla(${this.hue + 10}, ${this.saturation * 0.95}%, 75%, ${segmentOpacity})`;
                    electricCtx.lineWidth = segmentThickness;
                    electricCtx.stroke();
                }
            }

            // Draw glowing comet head
            const head = this.trail[this.trail.length - 1];
            if (head) {
                // Outer warm glow
                const outerGlow = electricCtx.createRadialGradient(
                    head.x, head.y, 0,
                    head.x, head.y, 20
                );
                outerGlow.addColorStop(0, `hsla(${this.hue}, ${this.saturation}%, 70%, ${this.life * 0.6})`);
                outerGlow.addColorStop(0.5, `hsla(${this.hue - 10}, ${this.saturation * 0.8}%, 50%, ${this.life * 0.3})`);
                outerGlow.addColorStop(1, 'transparent');

                electricCtx.beginPath();
                electricCtx.arc(head.x, head.y, 20, 0, Math.PI * 2);
                electricCtx.fillStyle = outerGlow;
                electricCtx.fill();

                // Bright core
                const coreGlow = electricCtx.createRadialGradient(
                    head.x, head.y, 0,
                    head.x, head.y, 8
                );
                coreGlow.addColorStop(0, `hsla(55, ${this.saturation}%, 98%, ${this.life * 0.95})`);
                coreGlow.addColorStop(0.4, `hsla(${this.hue + 15}, ${this.saturation}%, 80%, ${this.life * 0.7})`);
                coreGlow.addColorStop(1, 'transparent');

                electricCtx.beginPath();
                electricCtx.arc(head.x, head.y, 8, 0, Math.PI * 2);
                electricCtx.fillStyle = coreGlow;
                electricCtx.fill();
            }

            // Draw branches with same golden tapering effect
            this.branches.forEach(branch => {
                if (branch.trail.length > 1) {
                    for (let i = 0; i < branch.trail.length - 1; i++) {
                        const p1 = branch.trail[i];
                        const p2 = branch.trail[i + 1];
                        const progress = i / (branch.trail.length - 1);
                        const segmentThickness = this.thickness * 0.5 * (0.1 + progress * 0.9);
                        const segmentOpacity = branch.life * (0.1 + progress * 0.4);

                        electricCtx.beginPath();
                        electricCtx.moveTo(p1.x, p1.y);
                        electricCtx.lineTo(p2.x, p2.y);
                        electricCtx.strokeStyle = `hsla(${this.hue}, ${this.saturation * 0.9}%, 70%, ${segmentOpacity})`;
                        electricCtx.lineWidth = segmentThickness;
                        electricCtx.stroke();
                    }

                    // Branch head glow
                    const bHead = branch.trail[branch.trail.length - 1];
                    if (bHead) {
                        const bGrad = electricCtx.createRadialGradient(bHead.x, bHead.y, 0, bHead.x, bHead.y, 5);
                        bGrad.addColorStop(0, `hsla(55, ${this.saturation}%, 90%, ${branch.life * 0.7})`);
                        bGrad.addColorStop(1, 'transparent');
                        electricCtx.beginPath();
                        electricCtx.arc(bHead.x, bHead.y, 5, 0, Math.PI * 2);
                        electricCtx.fillStyle = bGrad;
                        electricCtx.fill();
                    }
                }
            });
        }
    }

    function animateElectric() {
        if (!electricCtx || !animationRunning) return;

        // Fade previous frame
        electricCtx.fillStyle = 'rgba(3, 1, 8, 0.35)';
        electricCtx.fillRect(0, 0, electricWidth, electricHeight);

        // Maintain configured number of active signals
        const targetCount = CONFIG.pulses?.count || 6;
        if (signals.length < targetCount && Math.random() < 0.03) {
            signals.push(new SignalPulse());
        }

        signals = signals.filter(signal => {
            const alive = signal.update();
            if (alive) signal.draw();
            else if (signals.length < targetCount - 2) signals.push(new SignalPulse());
            return alive;
        });

        requestAnimationFrame(animateElectric);
    }

    let animationRunning = true;
    let resizeTimeout = null;

    async function initElectricAnimation() {
        if (!electricCanvas) return;
        resizeElectricCanvas();
        window.addEventListener('resize', () => {
            resizeElectricCanvas();
            // Debounce: only recreate map after resize stops
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                createBrightnessMap('images/paths.png');
            }, 300);
        });

        // Load path map from separate mask image (white = paths, black = avoid)
        await createBrightnessMap('images/paths.png');

        // Start with configured number of signals
        const initialCount = CONFIG.pulses?.count || 6;
        for (let i = 0; i < initialCount; i++) {
            signals.push(new SignalPulse());
        }
        animationRunning = true;
        animateElectric();
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Render content from CONFIG
        renderHero();
        renderNews();
        renderResearch();
        renderTeam();
        renderFunding();
        renderPublications();
        renderStats();
        renderGallery();
        renderFooter();

        // Initialize effects
        initParticles();
        initNavScroll();
        initMobileMenu();
        initSmoothScroll();
        initScrollReveal();
        initTapRipple();
        initGyroParallax();
        initElectricAnimation();
    });
    </script>
</body>
</html>
